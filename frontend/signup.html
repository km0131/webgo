<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>æ–°è¦ç™»éŒ²ç”»é¢</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        /* ç”»é¢ä¸­å¤®ã«ã‚«ãƒ¼ãƒ‰ã‚’è¡¨ç¤ºã™ã‚‹ãŸã‚ã®ã‚«ã‚¹ã‚¿ãƒ ã‚¹ã‚¿ã‚¤ãƒ« */
        .signup-container {
            min-height: 100vh;
            display: flex;
            justify-content: center;
            padding: 2rem 0;
            background-color: #f8f9fa;
            /* èƒŒæ™¯è‰²ã‚’è–„ã„ã‚°ãƒ¬ãƒ¼ã«è¨­å®š */
        }

        .signup-card {
            width: 100%;
            max-width: 420px;
            /* ã‚«ãƒ¼ãƒ‰ã®æœ€å¤§å¹…ã‚’è¨­å®š */
            padding: 30px;
            box-shadow: 0 4px 8px rgba(0, 0, 0, .05);
            border-top-left-radius: 0;
            /* ã‚¿ãƒ–ã¨ç¹‹ã’ã‚‹ãŸã‚ã«å·¦ä¸Šã®è§’ä¸¸ã‚’ãªãã™ */
            border-top-right-radius: 0;
            /* ã‚¿ãƒ–ã¨ç¹‹ã’ã‚‹ãŸã‚ã«å³ä¸Šã®è§’ä¸¸ã‚’ãªãã™ */
        }

        /* ã‚¿ãƒ–è‡ªä½“ã®ã‚¹ã‚¿ã‚¤ãƒ«èª¿æ•´ */
        .nav-tabs {
            border-bottom: none;
            /* ã‚¿ãƒ–ä¸‹ã®ç·šã‚’æ¶ˆã—ã¦ã‚«ãƒ¼ãƒ‰ã®æ ç·šã¨ä¸€ä½“åŒ– */
        }

        .nav-tabs .nav-link {
            border-bottom: 1px solid #dee2e6;
            /* éã‚¢ã‚¯ãƒ†ã‚£ãƒ–ã‚¿ãƒ–ã®ä¸‹ç·š */
        }

        .nav-tabs .nav-link.active {
            border-bottom-color: transparent;
            /* ã‚¢ã‚¯ãƒ†ã‚£ãƒ–ãªã‚¿ãƒ–ã®ä¸‹ç·šã‚’æ¶ˆã™ */
        }

        .selectable-image {
            width: 150px; /* 2åˆ—è¡¨ç¤ºã«åˆã†ã‚ˆã†ã«å¹…ã‚’èª¿æ•´ */
            height: 150px; /* 2åˆ—è¡¨ç¤ºã«åˆã†ã‚ˆã†ã«é«˜ã•ã‚’èª¿æ•´ */
            object-fit: cover;
            cursor: pointer;
            border: 4px solid transparent; /* åˆæœŸçŠ¶æ…‹ã§ã¯é€æ˜ãªæ ç·š */
            border-radius: 8px; /* è§’ä¸¸ã‚’é©ç”¨ */
            transition: border-color 0.2s, box-shadow 0.2s, transform 0.1s;
        }

        /* é¸æŠã•ã‚ŒãŸç”»åƒã«é©ç”¨ã™ã‚‹ã‚¹ã‚¿ã‚¤ãƒ« */
        .selectable-image.selected {
            border: 3px solid #007bff;
            /* é’ã„æ ç·šã‚’è¡¨ç¤º */
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
        }

        #student-image-gallery,
        #teacher-image-gallery {
            /* ä¿®æ­£ç‚¹: Flexboxã‹ã‚‰Gridã«å¤‰æ›´ã—ã€å¸¸ã«2åˆ—(1fr 1fr)ã§è¡¨ç¤ºã•ã‚Œã‚‹ã‚ˆã†ã«è¨­å®š */
            display: grid;
            grid-template-columns: 1fr 1fr; /* 2ã¤ã®å‡ç­‰ãªåˆ—ã‚’ä½œæˆ */
            gap: 10px; /* ç”»åƒé–“ã®ã‚¹ãƒšãƒ¼ã‚¹ */
            margin-bottom: 1.5rem;
        }

        /* 1. æ¨™æº–ã®ãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’éè¡¨ç¤ºã«ã™ã‚‹ */
        .image-checkbox {
            /* çµ¶å¯¾ã«éè¡¨ç¤ºã«ã—ã€ãƒ¬ã‚¤ã‚¢ã‚¦ãƒˆã«å½±éŸ¿ã‚’ä¸ãˆãªã„ã‚ˆã†ã«ã™ã‚‹ */
            position: absolute;
            opacity: 0;
            width: 0;
            height: 0;
        }

        /* 2. ç”»åƒã®åˆæœŸã‚¹ã‚¿ã‚¤ãƒ« */
        .selectable-image {
            cursor: pointer;
            /* ãƒã‚¦ã‚¹ã‚ªãƒ¼ãƒãƒ¼æ™‚ã«ã‚¯ãƒªãƒƒã‚¯å¯èƒ½ã§ã‚ã‚‹ã“ã¨ã‚’ç¤ºã™ */
            border: 4px solid transparent;
            /* åˆæœŸçŠ¶æ…‹ã§ã¯é€æ˜ãªæ ç·š */
            transition: border-color 0.2s, box-shadow 0.2s;
            /* å¤‰åŒ–ã‚’æ»‘ã‚‰ã‹ã«ã™ã‚‹ */
        }

        /* 3. ç”»åƒãŒé¸æŠã•ã‚ŒãŸï¼ˆãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ãŒãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸï¼‰æ™‚ã®ã‚¹ã‚¿ã‚¤ãƒ« */
        /* input:checked + label .selectable-image ã®çµ„ã¿åˆã‚ã›ã§ã€ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸinputã®ç›´å¾Œã®labelå†…ã®ç”»åƒã‚’é¸æŠ */
        .image-checkbox:checked+label .selectable-image {
            border-color: #007bff;
            /* ä¾‹: é’ã„æ ç·š */
            box-shadow: 0 0 10px rgba(0, 123, 255, 0.5);
            /* ä¾‹: å½±ã‚’ä»˜ã‘ã‚‹ */
            /* å¿…è¦ã«å¿œã˜ã¦ã€èƒŒæ™¯ã‚’è–„ãå¤‰ãˆã‚‹ãªã©ã‚‚åŠ¹æœçš„ã§ã™ */
        }
    </style>
</head>

<body>
    <div class="signup-container">
        <!-- ã‚¿ãƒ–ã¨ã‚«ãƒ¼ãƒ‰ã‚’ã¾ã¨ã‚ã‚‹ã‚³ãƒ³ãƒ†ãƒŠ -->
        <div style="width: 100%; max-width: 420px;">
            <!-- Nav tabs (ã‚«ãƒ¼ãƒ‰ã®å¤–ã«ç§»å‹•) -->
            <ul class="nav nav-tabs nav-fill" id="signupTab" role="tablist">
                <li class="nav-item" role="presentation">
                    <button class="nav-link active" id="student-tab" data-bs-toggle="tab" data-bs-target="#student-pane"
                        type="button" role="tab" aria-controls="student-pane" aria-selected="true">ç”Ÿå¾’ç”¨</button>
                </li>
                <li class="nav-item" role="presentation">
                    <button class="nav-link" id="teacher-tab" data-bs-toggle="tab" data-bs-target="#teacher-pane"
                        type="button" role="tab" aria-controls="teacher-pane" aria-selected="false">å…ˆç”Ÿç”¨</button>
                </li>
            </ul>
            <div class="card signup-card">
                <div class="card-body">
                    <!-- Tab panes -->
                    <div class="tab-content pt-3" id="signupTabContent">
                        <!-- ç”Ÿå¾’ç”¨ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
                        <div class="tab-pane fade show active" id="student-pane" role="tabpanel"
                            aria-labelledby="student-tab" tabindex="0">
                            <h3 class="card-title text-center mb-4">æ–°è¦ç™»éŒ² (ç”Ÿå¾’ç”¨)</h3>
                            <form action="/signup" method="POST">
                                <div class="mb-3">
                                    <label for="studentUsername" class="form-label">
                                        ğŸ‘¤ãƒ¦ãƒ¼ã‚¶ãƒ¼å
                                    </label>
                                    <input type="text" class="form-control" id="studentUsername" name="inputUsername"
                                        required>
                                </div>

                                <label for="teacherEmail" class="form-label">
                                    ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰(3ã¤ã®ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„)
                                </label>
                                <div id="student-image-gallery">
                                    {{range $index, $path := .img}}
                                    <div class="image-choice-container">
                                        <input type="checkbox" id="student-img-{{$index}}" name="selected_images[]"
                                            value="{{index $.img_name $index}}" class="image-checkbox">

                                        <label for="student-img-{{$index}}">
                                            <img src="{{$path}}" data-id="{{index $.img_name $index}}"
                                                class="selectable-image" alt="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»åƒ">
                                        </label>
                                    </div>
                                    {{end}}
                                </div>
                                <p id="student_match_message" style="margin-top: 10px;"></p>

                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-primary btn-lg" id="studentSubmitBtn">
                                        ç™»éŒ²ã™ã‚‹
                                    </button>
                                </div>
                            </form>
                        </div>

                        <!-- å…ˆç”Ÿç”¨ç™»éŒ²ãƒ•ã‚©ãƒ¼ãƒ  -->
                        <div class="tab-pane fade" id="teacher-pane" role="tabpanel" aria-labelledby="teacher-tab"
                            tabindex="0">
                            <h3 class="card-title text-center mb-4">æ–°è¦ç™»éŒ² (å…ˆç”Ÿç”¨)</h3>
                            <form action="/signup" method="POST">
                                <div class="mb-3">
                                    <label for="teacherUsername" class="form-label">
                                        ğŸ‘¤ãƒ¦ãƒ¼ã‚¶ãƒ¼å
                                    </label>
                                    <input type="text" class="form-control" id="teacherUsername" name="inputUsername"
                                        required>
                                </div>

                                <div class="mb-3">
                                    <label for="teacherEmail" class="form-label">
                                        âœ‰ï¸ ãƒ¡ãƒ¼ãƒ«ã‚¢ãƒ‰ãƒ¬ã‚¹
                                    </label>
                                    <input type="email" class="form-control" id="teacherEmail" name="email" required>
                                </div>

                                <label for="teacherEmail" class="form-label">
                                    ğŸ” ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰(3ã¤ã®ç”»åƒã‚’é¸æŠã—ã¦ãã ã•ã„)
                                </label>
                                <div id="teacher-image-gallery">
                                    {{range $index, $path := .img}}
                                    <div class="image-choice-container">
                                        <input type="checkbox" id="img-{{$index}}" name="selected_images[]"
                                            value="{{index $.img_name $index}}" class="image-checkbox">

                                        <label for="img-{{$index}}">
                                            <img src="{{$path}}" data-id="{{index $.img_name $index}}"
                                                class="selectable-image" alt="ãƒ‘ã‚¹ãƒ¯ãƒ¼ãƒ‰ç”»åƒ">
                                        </label>
                                    </div>
                                    {{end}}
                                </div>

                                <p id="teacher_match_message" style="margin-top: 10px;"></p>

                                <div class="d-grid gap-2">
                                    <button type="submit" class="btn btn-success btn-lg" id="teacherSubmitBtn">
                                        ç™»éŒ²ã™ã‚‹
                                    </button>
                                </div>
                            </form>
                        </div>
                    </div>

                    <hr class="my-4">

                    <div class="text-center">
                        <a href="/" class="d-block text-decoration-none">
                            ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’ãŠæŒã¡ã®æ–¹ã¯ã“ã¡ã‚‰ï¼ˆãƒ­ã‚°ã‚¤ãƒ³ï¼‰
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </div>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        document.addEventListener('DOMContentLoaded', function () {
            /**
             * ç”»åƒé¸æŠãƒ•ã‚©ãƒ¼ãƒ ã®é€ä¿¡ã‚’æ¤œè¨¼ã™ã‚‹é–¢æ•°
             * @param {string} formSelector - å¯¾è±¡ãƒ•ã‚©ãƒ¼ãƒ ã®CSSã‚»ãƒ¬ã‚¯ã‚¿
             * @param {string} messageSelector - ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’è¡¨ç¤ºã™ã‚‹è¦ç´ ã®CSSã‚»ãƒ¬ã‚¯ã‚¿
             */
            function validateImageSelection(formSelector, messageSelector) {
                const form = document.querySelector(formSelector);
                const messageElement = document.querySelector(messageSelector);

                if (!form || !messageElement) return;

                form.addEventListener('submit', function (event) {
                    // ãƒ•ã‚©ãƒ¼ãƒ å†…ã®ãƒã‚§ãƒƒã‚¯ã•ã‚ŒãŸãƒã‚§ãƒƒã‚¯ãƒœãƒƒã‚¯ã‚¹ã‚’å–å¾—
                    const selectedImages = form.querySelectorAll('.image-checkbox:checked');

                    // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆã®é€ä¿¡ã‚’ä¸€æ—¦åœæ­¢
                    event.preventDefault();

                    messageElement.textContent = ''; // ãƒ¡ãƒƒã‚»ãƒ¼ã‚¸ã‚’ã‚¯ãƒªã‚¢

                    if (selectedImages.length < 3) {
                        messageElement.textContent = 'é¸æŠã•ã‚ŒãŸç”»åƒãŒå°‘ãªã™ãã¾ã™ã€‚(3ã¤é¸æŠã—ã¦ãã ã•ã„)';
                        messageElement.style.color = 'red';
                    } else if (selectedImages.length > 3) {
                        // ã“ã®ãƒ«ãƒ¼ãƒˆã¯changeãƒªã‚¹ãƒŠãƒ¼ã§ãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã¦ã„ã‚‹ã¯ãšã ãŒã€å¿µã®ãŸã‚
                        messageElement.textContent = 'é¸æŠã•ã‚ŒãŸç”»åƒãŒå¤šã™ãã¾ã™ã€‚(3ã¤é¸æŠã—ã¦ãã ã•ã„)';
                        messageElement.style.color = 'red';
                    } else {
                        // ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸ
                        messageElement.textContent = 'ç”»åƒã‚’3æšé¸æŠã—ã¾ã—ãŸã€‚ã‚¢ã‚«ã‚¦ãƒ³ãƒˆã‚’æ–°è¦ä½œæˆã—ã¾ã™ã€‚';
                        messageElement.style.color = 'green';
                        form.submit();
                    }
                });

                // é¸æŠæšæ•°ã‚’ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§ãƒã‚§ãƒƒã‚¯ã—ã€æœ€å¤§3æšã«åˆ¶é™ã™ã‚‹ãƒªã‚¹ãƒŠãƒ¼
                const checkboxes = form.querySelectorAll('.image-checkbox');
                checkboxes.forEach(checkbox => {
                    checkbox.addEventListener('change', () => {
                        const count = form.querySelectorAll('.image-checkbox:checked').length;
                        
                        if (count > 3) {
                            // 4æšç›®ä»¥é™ã®é¸æŠã‚’ãƒ–ãƒ­ãƒƒã‚¯
                            checkbox.checked = false;
                            messageElement.textContent = 'é¸æŠã§ãã‚‹ç”»åƒã¯æœ€å¤§3æšã¾ã§ã§ã™ã€‚';
                            messageElement.style.color = 'red';
                        } else if (count === 3) {
                            messageElement.textContent = 'ç”»åƒãŒ3ã¤é¸æŠã•ã‚Œã¾ã—ãŸã€‚ãƒ­ã‚°ã‚¤ãƒ³å¯èƒ½ã§ã™ã€‚';
                            messageElement.style.color = 'green';
                        } else {
                            messageElement.textContent = `é¸æŠä¸­ã®ç”»åƒ: ${count}/3æš`;
                            messageElement.style.color = 'gray';
                        }
                    });
                });
            }

            // ç”Ÿå¾’ç”¨ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            validateImageSelection('#student-pane form', '#student_match_message');

            // å…ˆç”Ÿç”¨ãƒ•ã‚©ãƒ¼ãƒ ã®ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚’ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—
            validateImageSelection('#teacher-pane form', '#teacher_match_message');
        });
    </script>
</body>

</html>